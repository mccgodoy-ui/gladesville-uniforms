<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pre-Loved Uniforms ‚Äî Gladesville Public School</title>

  <!-- Elegant fonts -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

  <style>
    :root{ --brand-navy:#0f3d63; --brand-teal:#0f8b8d; --brand-yellow:#facc15; }
    /* Tailwind config inline */
    .font-display { font-family: "DM Serif Display", serif; }
    .font-sans { font-family: Outfit, ui-sans-serif, system-ui; }
    .text-brandNavy { color: #0f3d63; }
    .bg-brandNavy { background-color: #0f3d63; }
    .text-brandTeal { color: #0f8b8d; }
    .bg-brandTeal { background-color: #0f8b8d; }
    .text-brandYellow { color: #facc15; }
    .bg-brandYellow { background-color: #facc15; }
    .bg-softSky { background-color: #eaf7f6; }
    .bg-softMint { background-color: #e6faf9; }
    .shadow-card { box-shadow: 0 10px 30px rgba(16,24,40,.08); }
    .rounded-xxl { border-radius: 1.25rem; }
    
    .pill{ padding:.5rem .9rem;border-radius:9999px;font-size:.875rem;font-weight:600;transition:all .15s }
    .pill-active{ background:var(--brand-yellow);color:#1f2937;box-shadow:0 6px 14px rgba(250,204,21,.25) }
    .pill-idle{ background:#fff;color:#0f3d63;border:1px solid #e5e7eb }
    .pill-idle:hover{ background:#f7fafc }
    .chip{ border-radius:9999px;padding:.45rem .8rem;border:1px solid #cbd5e1 }
    .chip-teal{ border-color:#99d5d6;color:#064e4f;background:#e6faf9 }
    .field{ border:1px solid #e5e7eb;border-radius:12px;padding:.7rem .9rem;width:100% }
    .field:focus{ outline:none;border-color:#99d5d6;box-shadow:0 0 0 3px rgba(9,132,135,.12) }
    .card{ background:#fff;border-radius:1rem;box-shadow:0 6px 24px rgba(16,24,40,.08) }
    .badge{ background:#fff;color:#0f8b8d;border:1px solid #c7ecea;border-radius:9999px;padding:.25rem .6rem;font-size:.75rem;font-weight:600 }
    .sticky-card{ position:sticky; top:1rem }
    .banner{
      background:
        linear-gradient(135deg, rgba(15,61,99,.85), rgba(15,139,141,.75)),
        linear-gradient(45deg, #4f46e5, #06b6d4, #10b981);
      background-size: 400% 400%;
      animation: gradientShift 8s ease infinite;
    }
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    }
    .modal-content {
      background: white;
      border-radius: 1rem;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
    }
    .highlight-section {
      background: linear-gradient(135deg, #fef3c7, #fde68a) !important;
      border: 2px solid var(--brand-yellow) !important;
      transform: scale(1.02);
      transition: all 0.3s ease;
    }
    .volunteer-form-animate {
      animation: slideInUp 0.3s ease-out;
    }
    @keyframes slideInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body class="bg-gray-50 text-slate-800 font-sans">
  <!-- HERO -->
  <header class="banner text-white">
    <div class="max-w-6xl mx-auto px-4 py-10 md:py-14">
      <div class="flex items-center gap-2 mb-3 flex-wrap">
        <span class="badge bg-white/90 text-brandNavy border-none">Community volunteers</span>
        <!-- removed "Pick up @ New Hub (Linsley St.)" by request -->
        <span class="badge bg-white/95 text-emerald-700 border-emerald-300">‚ôªÔ∏è Sustainable ‚Äî Reuse & Donate</span>
      </div>
      <h1 class="font-display text-3xl md:text-5xl leading-tight">Pre-Loved Uniform Shop</h1>
      <p class="mt-3 max-w-2xl text-white/90">
        Save money, reduce waste, and kit out our kids.
      </p>
      <div class="mt-6 flex flex-wrap gap-3">
        <a href="#shop" class="inline-flex items-center gap-2 bg-brandYellow text-slate-900 font-semibold rounded-2xl px-5 py-3">
          Start Pre-Order <span aria-hidden>‚Üí</span>
        </a>
        <a href="#how" class="inline-flex items-center gap-2 border border-white/30 rounded-2xl px-5 py-3" onclick="event.preventDefault(); scrollToSection('how');">How it works</a>
      </div>
    </div>
  </header>

  <main id="app" class="max-w-6xl mx-auto px-4 py-8">Loading‚Ä¶</main>

  <!-- Volunteer callout section -->
  <section class="max-w-4xl mx-auto my-12 card p-8 text-center">
    <h2 class="text-2xl font-display text-brandNavy mb-3">We need volunteers!</h2>
    <p class="text-slate-600 mb-4">
      The uniform shop runs on community spirit üíõ. If you can help with sorting, sales, or admin, we would love to hear from you.
    </p>
    <a href="#shop" class="inline-block bg-brandYellow text-slate-900 px-6 py-3 rounded-xl font-semibold" onclick="event.preventDefault(); openVolunteerModal();">
      Put me down to help
    </a>
    <p class="mt-4 text-xs text-slate-500">
      Donation bins are located at the <strong>School Admin area</strong> ‚Äî thank you for supporting reuse ‚ôªÔ∏è
    </p>
  </section>

  <footer class="mt-10 py-8 text-center text-sm text-slate-500">
    ¬© Gladesville Public School Second-Hand Uniform Shop ‚Äî Community volunteers
  </footer>

  <script>
    /* ===== EmailJS config ===== */
    const EMAILJS_SERVICE_ID = 'service_z6psqlh';
    const EMAILJS_TEMPLATE_ID = 'template_6t31ggp';
    const EMAILJS_PUBLIC_KEY  = 'SqZoo_2xHoSq2VLVb';
    (function(){ emailjs.init(EMAILJS_PUBLIC_KEY); })();

    /* ===== Optional: Google Sheets logging (set URL or leave blank to disable) ===== */
    const SHEETS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwiTJScWiP3FTyWJFAuu6hfM54TOXj0i2fuyOZ1SAKSc8Y9lk1Bcoi3-HaAi6Hq6bSqLA/exec'
    const SHEETS_ENABLED = !!SHEETS_WEB_APP_URL;

    /* ===== State ===== */
    let currentView = 'shop';
    let cart = JSON.parse(localStorage.getItem('gps_cart') || '{}');
    let customerInfo = JSON.parse(localStorage.getItem('gps_customer') || JSON.stringify({
      name:'', whatsapp:'', studentClass:'', notes:'', volunteer:false, volunteerAvailability:''
    }));
    let orders = JSON.parse(localStorage.getItem('gps_orders') || '[]');
    let isSubmitting = false;
    let showSuccessMessage = false;
    let showVolunteerModal = false;
    let volunteerInfo = { name: '', phone: '' };
    let isSubmittingVolunteer = false;
    let isAdminLoggedIn = false;
    const adminPassword = 'gps25';
    let editingItemId = null;
    let activeCategory = 'All';
    let searchQuery = '';

    let inventory = [
      {id:1, name:'Polo Shirt', price:2, category:'Shirts'},
      {id:2, name:'Long Sleeve Polo', price:2, category:'Shirts'},
      {id:3, name:'School Pants', price:2, category:'Bottoms'},
      {id:4, name:'Skort', price:2, category:'Bottoms'},
      {id:5, name:'Summer Dress', price:2, category:'Dresses'},
      {id:6, name:'Winter Tunic', price:2, category:'Dresses'},
      {id:7, name:'Jumper', price:5, category:'Winter'},
      {id:8, name:'School Hat', price:2, category:'Accessories'}
    ];
    const sizes = ['4','6','8','10','12','14','16'];
    const categories = ['All','Shirts','Bottoms','Dresses','Winter','Accessories'];

    /* ===== Helpers ===== */
    const saveLocal = () => {
      localStorage.setItem('gps_cart', JSON.stringify(cart));
      localStorage.setItem('gps_customer', JSON.stringify(customerInfo));
      localStorage.setItem('gps_orders', JSON.stringify(orders));
    };
    const setCategory = c => { activeCategory = c; render(); };
    const setSearch = v => { searchQuery = v; render(); };
    const updateName  = v => { customerInfo.name = v; saveLocal(); };
    const updateWhats = v => { customerInfo.whatsapp = v; saveLocal(); };
    const updateClass = v => { customerInfo.studentClass = v; saveLocal(); };
    const updateNotes = v => { customerInfo.notes = v; saveLocal(); };
    const updateVol   = v => { customerInfo.volunteer = v; saveLocal(); };
    const updateAvail = v => { customerInfo.volunteerAvailability = v; saveLocal(); };
    const getCartTotal = () => Object.values(cart).reduce((s,i)=> s + i.price*i.quantity, 0);
    const getCartCount = () => Object.values(cart).reduce((s,i)=> s + i.quantity, 0);

    // Volunteer modal functions
    const openVolunteerModal = () => { showVolunteerModal = true; render(); };
    const closeVolunteerModal = () => { showVolunteerModal = false; volunteerInfo = { name: '', phone: '' }; render(); };
    const updateVolunteerName = v => { volunteerInfo.name = v; };
    const updateVolunteerPhone = v => { volunteerInfo.phone = v; };

    // Smooth scroll to section with highlight
    const scrollToSection = (id) => {
      const element = document.getElementById(id);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth' });
        element.classList.add('highlight-section');
        setTimeout(() => {
          element.classList.remove('highlight-section');
        }, 2000);
      }
    };

    function filteredInventory() {
      let items = (activeCategory === 'All') ? inventory : inventory.filter(i => i.category === activeCategory);
      if (searchQuery.trim()) {
        const q = searchQuery.trim().toLowerCase();
        items = items.filter(i => i.name.toLowerCase().includes(q) || i.category.toLowerCase().includes(q));
      }
      return items;
    }
    function addToCart(id, size) {
      const item = inventory.find(i => i.id === id);
      if (!item) return;
      const key = `${id}-${size}`;
      if (cart[key]) cart[key].quantity += 1;
      else cart[key] = { id:item.id, name:item.name, price:item.price, size, quantity:1 };
      saveLocal(); render();
    }
    function removeFromCart(key) {
      if (!cart[key]) return;
      if (cart[key].quantity > 1) cart[key].quantity -= 1; else delete cart[key];
      saveLocal(); render();
    }

    function formatItemsList(obj) {
      return Object.values(obj).map(it => `${it.quantity}x ${it.name} (Size ${it.size}) - $${(it.price*it.quantity)}`).join('\n');
    }
    function formatOrderForEmail(order) {
      let msg = `NEW UNIFORM PRE-ORDER\n\n`;
      msg += `Customer Details:\n`;
      msg += `Name: ${order.customer.name}\n`;
      msg += `WhatsApp: ${order.customer.whatsapp}\n`;
      msg += `Class: ${order.customer.studentClass}\n`;
      msg += `Date: ${order.date}\n`;
      msg += `Time: ${order.time}\n`;
      if (order.customer.notes) msg += `Notes: ${order.customer.notes}\n`;
      msg += `Volunteer: ${order.customer.volunteer ? 'Yes' : 'No'}\n`;
      if (order.customer.volunteer && order.customer.volunteerAvailability) {
        msg += `Volunteer Availability: ${order.customer.volunteerAvailability}\n`;
      }
      msg += `\nItems Ordered:\n${formatItemsList(order.items)}\n\nTotal: $${order.total}\n`;
      return msg;
    }
    function toast(msg, ok=true) {
      const t = document.createElement('div');
      t.className = `fixed left-1/2 -translate-x-1/2 top-4 z-50 px-4 py-3 rounded-2xl text-sm shadow-card ${ok?'bg-green-600 text-white':'bg-red-600 text-white'}`;
      t.textContent = msg; document.body.appendChild(t); setTimeout(()=> t.remove(), 2200);
    }

    /* ===== Email + optional Sheets ===== */
    async function sendEmail(order) {
      const params = {
        to_email: 'mccgodoy@gmail.com',
        customer_name: order.customer.name,
        customer_whatsapp: order.customer.whatsapp,
        customer_class: order.customer.studentClass,
        customer_notes: order.customer.notes || 'None',
        order_date: order.date, 
        order_time: order.time,
        items_list: formatItemsList(order.items),
        order_total: order.total, 
        order_id: order.id,
        volunteer: order.customer.volunteer ? 'Yes' : 'No',
        volunteer_availability: order.customer.volunteerAvailability || 'N/A'
      };
      await emailjs.send('service_z6psqlh','template_6t31ggp',params);
    }
    async function sendToSheet(order){
      if (!SHEETS_ENABLED) return;
      try {
        await fetch(SHEETS_WEB_APP_URL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(order)
        });
      } catch(e){ console.error('Sheets logging failed', e); }
    }

    async function submitOrder() {
      if (!customerInfo.name || !customerInfo.whatsapp || !customerInfo.studentClass) {
        toast('Please fill your name, WhatsApp and class.', false); return;
      }
      if (Object.keys(cart).length === 0) { toast('Your cart is empty.', false); return; }

      isSubmitting = true; render();

      const order = {
        id: Date.now(),
        customer: {...customerInfo},
        items: {...cart},
        total: getCartTotal(),
        date: new Date().toLocaleDateString(),
        time: new Date().toLocaleTimeString()
      };

      try {
        await Promise.all([ sendEmail(order), sendToSheet(order) ]);
        toast('Order sent! We will be in touch.', true);
      } catch(e){
        console.error(e);
        // fall back: open a mailto with the order text
        const mailto = 'mailto:mccgodoy@gmail.com'
          + '?subject=' + encodeURIComponent('New Uniform Pre-Order - ' + order.customer.name)
          + '&body=' + encodeURIComponent(formatOrderForEmail(order));
        window.open(mailto);
        toast('Email app opened as fallback.', true);
      }

      // Clear cart & fields but keep class for convenience
      orders.push(order);
      cart = {};
      customerInfo = { name:'', whatsapp:'', studentClass: order.customer.studentClass, notes:'', volunteer:false, volunteerAvailability:'' };
      saveLocal();

      isSubmitting = false; showSuccessMessage = true; render();
      setTimeout(()=> { showSuccessMessage = false; render(); }, 3500);
    }

    // Volunteer signup submission
    async function submitVolunteerSignup() {
      if (!volunteerInfo.name || !volunteerInfo.phone) {
        toast('Please fill in both name and phone number.', false);
        return;
      }

      isSubmittingVolunteer = true;
      render();

      const volunteerData = {
        name: volunteerInfo.name,
        phone: volunteerInfo.phone,
        date: new Date().toLocaleDateString(),
        time: new Date().toLocaleTimeString()
      };

      try {
        // Send volunteer signup email
        const params = {
          to_email: 'mccgodoy@gmail.com',
          volunteer_name: volunteerData.name,
          volunteer_phone: volunteerData.phone,
          signup_date: volunteerData.date,
          signup_time: volunteerData.time
        };
        
        // You'll need to create a new EmailJS template for volunteer signups
        // For now, using the same template but with different data
        await emailjs.send('service_z6psqlh','template_6t31ggp',{
          ...params,
          customer_name: volunteerData.name,
          customer_whatsapp: volunteerData.phone,
          customer_class: 'VOLUNTEER SIGNUP',
          items_list: 'New volunteer signup',
          order_total: 0,
          customer_notes: `Volunteer signup on ${volunteerData.date} at ${volunteerData.time}`,
          volunteer: 'Yes',
          volunteer_availability: 'To be discussed'
        });

        toast('Thank you! We will be in touch about volunteer opportunities.', true);
        closeVolunteerModal();
      } catch(e) {
        console.error(e);
        const mailto = 'mailto:mccgodoy@gmail.com'
          + '?subject=' + encodeURIComponent('New Volunteer Signup - ' + volunteerData.name)
          + '&body=' + encodeURIComponent(`NEW VOLUNTEER SIGNUP\n\nName: ${volunteerData.name}\nPhone: ${volunteerData.phone}\nDate: ${volunteerData.date}\nTime: ${volunteerData.time}\n\nPlease contact this person about volunteer opportunities.`);
        window.open(mailto);
        toast('Email app opened as fallback.', true);
        closeVolunteerModal();
      }

      isSubmittingVolunteer = false;
    }

    /* ===== Admin etc. (unchanged except colour) ===== */
    function login(){ const pwd = prompt('Enter admin password:'); if (!pwd) return; if (pwd=== 'gps25'){ isAdminLoggedIn=true; currentView='admin'; render(); } else alert('Incorrect password'); }
    const logout=()=>{ isAdminLoggedIn=false; currentView='shop'; render(); };
    const goToShop=()=>{ currentView='shop'; render(); };
    function startEdit(id){ editingItemId=id; render(); }
    function cancelEdit(){ editingItemId=null; render(); }
    function saveEdit(id){
      const n = document.getElementById('edit_name_'+id)?.value.trim();
      const p = parseFloat(document.getElementById('edit_price_'+id)?.value);
      if (!n || isNaN(p)) return alert('Enter valid name & price.');
      const it = inventory.find(i=>i.id===id); it.name=n; it.price=p; editingItemId=null; render();
    }
    function removeItem(id){ inventory = inventory.filter(i=> i.id!==id); render(); }
    function addItem(){
      const n = document.getElementById('new_name').value.trim();
      const p = parseFloat(document.getElementById('new_price').value);
      const c = document.getElementById('new_category').value;
      if (!n || isNaN(p) || !c) return alert('Please fill all fields');
      const maxId = inventory.length ? Math.max(...inventory.map(i=>i.id)) : 0;
      inventory.push({ id:maxId+1, name:n, price:p, category:c });
      document.getElementById('new_name').value=''; document.getElementById('new_price').value='';
      render();
    }
    function deleteOrder(id){ orders = orders.filter(o=>o.id!==id); localStorage.setItem('gps_orders', JSON.stringify(orders)); render(); }
    function copyOrder(id){
      const o = orders.find(x=>x.id===id);
      const text = `NEW ORDER
Customer: ${o.customer.name}
WhatsApp: ${o.customer.whatsapp}
Class: ${o.customer.studentClass}
Date: ${o.date} ${o.time}
${o.customer.notes? 'Notes: '+o.customer.notes+'\n':''}
Volunteer: ${o.customer.volunteer ? 'Yes' : 'No'}
${o.customer.volunteer && o.customer.volunteerAvailability ? 'Availability: ' + o.customer.volunteerAvailability + '\n' : ''}
ITEMS:
${Object.values(o.items).map(i=> `${i.quantity}x ${i.name} (Size ${i.size})`).join('\n')}
TOTAL: ${o.total}`;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text);
      }
      alert('Order copied to clipboard.');
    }

    function headerBar(){
      const cartCount = getCartCount();
      const orderCount = orders.length;
      return `
        <div class="flex items-center justify-between py-4">
          <div class="flex items-center gap-2">
            <span class="w-9 h-9 rounded-full bg-brandTeal/10 flex items-center justify-center">üëï</span>
            <div>
              <h2 class="font-display text-xl text-brandNavy leading-tight">Gladesville Public School Second-Hand Uniforms</h2>
              <p class="text-xs text-slate-500 -mt-0.5">Pre-order & pickup</p>
            </div>
          </div>
          <div class="flex items-center gap-4">
            <button onclick="login()" class="relative hover:opacity-90" title="Admin">
              <span class="text-xl">‚öôÔ∏è</span>
              ${orderCount>0? `<span class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-5 h-5 text-xs grid place-items-center">${orderCount}</span>`:``}
            </button>
            <div class="relative" title="Cart">
              <span class="text-xl">üõí</span>
              ${cartCount>0? `<span class="absolute -top-1 -right-1 bg-brandYellow text-black rounded-full w-5 h-5 text-xs grid place-items-center">${cartCount}</span>`:``}
            </div>
          </div>
        </div>
      `;
    }
    function infoBlock(){
      return `
        <a id="how"></a>
        <div class="card p-6 md:p-7 bg-gradient-to-br from-softSky to-white border border-brandTeal/10">
          <h3 class="font-semibold text-brandNavy text-lg">How it works</h3>
          <ol class="mt-3 grid sm:grid-cols-2 gap-2 text-sm">
            <li>1) Select items and sizes.</li>
            <li>2) Submit your pre-order.</li>
            <li>3) We'll confirm availability.</li>
            <li>4) Pay via Qkr! or cash on pickup.</li>
          </ol>
          <div class="mt-3 text-xs text-slate-600">
            <strong>Donation bins:</strong> located at the <em>School Admin area</em>. Thank you for supporting reuse ‚ôªÔ∏è
          </div>
        </div>
      `;
    }
    function filters(){
      const pills = categories.map(c=>{
        const active = c===activeCategory;
        const cls = active ? 'pill pill-active' : 'pill pill-idle';
        return `<button onclick="setCategory('${c}')" class="${cls}">${c}</button>`;
      }).join('');
      return `
        <div class="card p-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
          <div class="flex gap-2 flex-wrap">${pills}</div>
          <div class="relative w-full md:w-72">
            <input class="field pl-10" placeholder="Search items‚Ä¶" value="${searchQuery}" oninput="setSearch(this.value)" />
            <span class="absolute left-3 top-2.5 text-slate-400">üîé</span>
          </div>
        </div>
      `;
    }
    function productGrid(){
      const items = filteredInventory();
      if (!items.length) return `<p class="text-center text-slate-500 py-8">No items found.</p>`;
      const cards = items.map(it=>{
        const sizeBtns = sizes.map(s=> `<button onclick="addToCart(${it.id},'${s}')" class="chip chip-teal hover:bg-softMint">${s}</button>`).join('');
        return `
          <div class="card p-4 flex flex-col gap-3">
            <div class="flex items-start justify-between">
              <div>
                <h4 class="font-semibold">${it.name}</h4>
                <span class="text-xs bg-slate-100 px-2 py-1 rounded">${it.category}</span>
              </div>
              <div class="text-lg font-bold text-brandNavy">$${it.price}</div>
            </div>
            <div class="text-sm text-slate-600">Select size:</div>
            <div class="flex gap-2 flex-wrap">${sizeBtns}</div>
          </div>
        `;
      }).join('');
      return `<div class="grid md:grid-cols-2 gap-5">${cards}</div>`;
    }
    function cartPanel(){
      const keys = Object.keys(cart);
      const total = getCartTotal();
      const canSubmit = customerInfo.name && customerInfo.whatsapp && customerInfo.studentClass && keys.length>0;
      const items = keys.length ? keys.map(k=>{
        const it = cart[k];
        return `
          <div class="flex justify-between items-center p-2 bg-slate-50 rounded-lg">
            <div>
              <div class="font-medium">${it.name}</div>
              <div class="text-xs text-slate-500">Size ${it.size}</div>
            </div>
            <div class="flex items-center gap-2">
              <button onclick="removeFromCart('${k}')" class="px-2 py-1 rounded bg-red-50 text-red-600">‚àí</button>
              <span>${it.quantity}</span>
              <button onclick="addToCart(${it.id},'${it.size}')" class="px-2 py-1 rounded bg-green-50 text-green-700">+</button>
            </div>
          </div>
        `;
      }).join('') : `<div class="text-center py-8 text-slate-500">No items yet</div>`;

      return `
        <div class="card sticky-card p-0 overflow-hidden">
          <div class="bg-brandTeal text-white px-5 py-4">
            <h3 class="text-lg font-semibold">Your Order</h3>
          </div>
          <div class="p-5 space-y-3">
            ${showSuccessMessage?`
              <div class="rounded-lg bg-green-50 border border-green-200 text-green-800 px-3 py-2 text-sm">
                Order submitted! We will be in touch shortly.
              </div>`:''}

            <div class="space-y-3">
              <input class="field" placeholder="Parent / Carer name *" value="${customerInfo.name}" oninput="updateName(this.value)" />
              <input class="field" placeholder="WhatsApp number *" value="${customerInfo.whatsapp}" oninput="updateWhats(this.value)" />
              <input class="field" placeholder="Student class * (e.g., 2 Blue / Teacher)" value="${customerInfo.studentClass}" oninput="updateClass(this.value)" />
              <textarea class="field" rows="2" placeholder="Notes (optional): brand/cut preference, condition, etc." oninput="updateNotes(this.value)">${customerInfo.notes||''}</textarea>

              <label class="flex items-start gap-2 text-sm">
                <input type="checkbox" ${customerInfo.volunteer?'checked':''} onchange="updateVol(this.checked)" />
                <span><strong>Volunteer with us:</strong> I'm happy to help at the shop or with sorting.</span>
              </label>
              <input class="field" placeholder="If volunteering ‚Äî availability (days/times)" value="${customerInfo.volunteerAvailability||''}" oninput="updateAvail(this.value)" />
            </div>

            <div class="space-y-2">${items}</div>

            ${keys.length?`
              <div class="border-t pt-3 flex items-center justify-between">
                <span class="font-semibold">Total</span>
                <span class="text-xl font-bold text-brandNavy">${total}</span>
              </div>`:''}

            <button onclick="submitOrder()" ${canSubmit?'':'disabled'}
              class="w-full inline-flex items-center justify-center rounded-xl px-5 py-3 font-semibold
                ${canSubmit? 'bg-brandYellow text-slate-900 hover:opacity-90' : 'bg-slate-200 text-slate-500'}">
              ${isSubmitting? 'Sending‚Ä¶' : 'Submit Pre-Order'}
            </button>

            <div class="text-xs text-slate-500 pt-2">
              Donation bins are at the <strong>School Admin area</strong> ‚Äî thank you for supporting reuse ‚ôªÔ∏è
            </div>
          </div>
        </div>
      `;
    }
    function shopView(){
      const volunteerModal = showVolunteerModal ? `
        <div class="modal-overlay" onclick="event.target === this && closeVolunteerModal()">
          <div class="modal-content volunteer-form-animate">
            <div class="bg-brandTeal text-white px-6 py-4 rounded-t-xl">
              <h3 class="text-xl font-semibold">Join Our Volunteer Team! üôå</h3>
            </div>
            <div class="p-6 space-y-4">
              <p class="text-slate-600">Thank you for wanting to help! Please provide your details and we will get in touch about volunteer opportunities.</p>
              
              <div class="space-y-3">
                <input 
                  class="field" 
                  placeholder="Your name *" 
                  value="${volunteerInfo.name}" 
                  oninput="updateVolunteerName(this.value)" 
                  ${isSubmittingVolunteer ? 'disabled' : ''}
                />
                <input 
                  class="field" 
                  placeholder="Phone number *" 
                  value="${volunteerInfo.phone}" 
                  oninput="updateVolunteerPhone(this.value)" 
                  ${isSubmittingVolunteer ? 'disabled' : ''}
                />
                
                <div class="bg-softMint p-3 rounded-lg border border-brandTeal/20">
                  <p class="text-sm text-slate-700 mb-2">üì± <strong>Join our WhatsApp group:</strong></p>
                  <a href="https://chat.whatsapp.com/xxx" target="_blank" class="text-brandTeal font-medium text-sm hover:underline">
                    Click here to join volunteer WhatsApp group
                  </a>
                  <p class="text-xs text-slate-500 mt-1">We coordinate volunteer activities through WhatsApp</p>
                </div>
              </div>

              <div class="flex gap-3 pt-4">
                <button 
                  onclick="submitVolunteerSignup()" 
                  class="flex-1 bg-brandYellow text-slate-900 py-3 px-4 rounded-xl font-semibold hover:opacity-90 ${isSubmittingVolunteer ? 'opacity-50 cursor-not-allowed' : ''}"
                  ${isSubmittingVolunteer ? 'disabled' : ''}
                >
                  ${isSubmittingVolunteer ? 'Submitting...' : 'Sign me up!'}
                </button>
                <button 
                  onclick="closeVolunteerModal()" 
                  class="px-4 py-3 border border-slate-300 rounded-xl hover:bg-slate-50 ${isSubmittingVolunteer ? 'opacity-50 cursor-not-allowed' : ''}"
                  ${isSubmittingVolunteer ? 'disabled' : ''}
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        </div>
      ` : '';

      return `
        ${headerBar()}
        <section id="shop" class="grid lg:grid-cols-3 gap-6">
          <div class="lg:col-span-2 space-y-6">
            ${infoBlock()}
            ${filters()}
            ${productGrid()}
          </div>
          <aside>${cartPanel()}</aside>
        </section>
        ${volunteerModal}
      `;
    }
    function adminView(){
      if (!isAdminLoggedIn) {
        return `
          ${headerBar()}
          <div class="min-h-[50vh] grid place-items-center">
            <div class="card p-8 text-center max-w-md">
              <h2 class="text-xl font-bold mb-3">Admin Access</h2>
              <p class="text-sm text-slate-600 mb-5">View orders & manage inventory.</p>
              <div class="flex gap-2 justify-center">
                <button onclick="login()" class="bg-brandTeal text-white px-4 py-2 rounded-lg">Login</button>
                <button onclick="goToShop()" class="border px-4 py-2 rounded-lg">Back</button>
              </div>
            </div>
          </div>
        `;
      }
      const inventoryList = inventory.map(it=>{
        if (editingItemId===it.id) {
          return `
            <div class="flex items-center gap-3 p-3 bg-sky-50 border-2 border-sky-200 rounded-lg">
              <input id="edit_name_${it.id}" value="${it.name}" class="field flex-1">
              <input id="edit_price_${it.id}" value="${it.price}" type="number" class="field w-24">
              <span class="text-xs bg-slate-100 px-2 py-1 rounded">${it.category}</span>
              <button onclick="saveEdit(${it.id})" class="bg-green-600 text-white px-3 py-1 rounded">Save</button>
              <button onclick="cancelEdit()" class="bg-slate-400 text-white px-3 py-1 rounded">Cancel</button>
            </div>`;
        }
        return `
          <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
            <div class="flex items-center gap-3">
              <span class="font-medium">${it.name}</span>
              <span class="text-xs bg-slate-100 px-2 py-1 rounded">${it.category}</span>
            </div>
            <div class="flex items-center gap-3">
              <span class="font-bold text-brandNavy">${it.price}</span>
              <button onclick="startEdit(${it.id})" class="bg-brandTeal text-white px-2 py-1 rounded text-sm">Edit</button>
              <button onclick="removeItem(${it.id})" class="bg-red-600 text-white px-2 py-1 rounded text-sm">Remove</button>
            </div>
          </div>`;
      }).join('');
      const ordersList = orders.map(o=>{
        const list = Object.values(o.items).map(i=> `<div class="text-sm">‚Ä¢ ${i.quantity}x ${i.name} (Size ${i.size})</div>`).join('');
        return `
          <div class="border rounded-xl p-4 bg-white shadow-sm">
            <div class="flex justify-between items-start mb-2">
              <div>
                <h3 class="font-semibold">${o.customer.name}</h3>
                <div class="text-sm text-slate-600">WhatsApp: ${o.customer.whatsapp}</div>
                <div class="text-sm text-slate-600">Class: ${o.customer.studentClass}</div>
                <div class="text-xs text-slate-500">${o.date} ${o.time}</div>
                ${o.customer.volunteer ? `<div class="text-xs text-emerald-700 mt-1">Volunteer: Yes ‚Äî ${o.customer.volunteerAvailability || 'availability TBD'}</div>` : ''}
              </div>
              <div class="text-right">
                <div class="text-lg font-bold text-brandNavy">${o.total}</div>
                <div class="flex gap-2 mt-2">
                  <button onclick="copyOrder(${o.id})" class="bg-brandTeal text-white px-2 py-1 rounded text-xs">Copy</button>
                  <button onclick="deleteOrder(${o.id})" class="bg-red-600 text-white px-2 py-1 rounded text-xs">Delete</button>
                </div>
              </div>
            </div>
            <div class="space-y-1">${list}</div>
          </div>`;
      }).join('');
      return `
        ${headerBar()}
        <section class="space-y-6">
          <div class="card p-4 flex items-center justify-between">
            <h1 class="text-2xl font-bold">Admin Panel</h1>
            <div class="space-x-2">
              <button onclick="logout()" class="bg-red-600 text-white px-3 py-2 rounded-lg">Logout</button>
              <button onclick="goToShop()" class="bg-brandTeal text-white px-3 py-2 rounded-lg">Shop</button>
            </div>
          </div>
          <div class="card p-4">
            <h2 class="text-xl font-semibold mb-4">Inventory (${inventory.length})</h2>
            <div class="space-y-2 mb-4">${inventoryList}</div>
            <div class="grid md:grid-cols-4 gap-3 p-3 bg-slate-50 rounded-lg">
              <input id="new_name" placeholder="Item name" class="field">
              <input id="new_price" placeholder="Price" type="number" class="field">
              <select id="new_category" class="field">
                <option value="Shirts">Shirts</option>
                <option value="Bottoms">Bottoms</option>
                <option value="Dresses">Dresses</option>
                <option value="Winter">Winter</option>
                <option value="Accessories">Accessories</option>
              </select>
              <button onclick="addItem()" class="bg-brandYellow text-slate-900 px-4 py-2 rounded-lg font-semibold">Add Item</button>
            </div>
          </div>
          <div class="card p-4">
            <h2 class="text-xl font-semibold mb-4">Orders (${orders.length})</h2>
            <div class="space-y-4">${ordersList || '<p class="text-slate-500">No orders yet</p>'}</div>
          </div>
        </section>
      `;
    }
    function render(){ document.getElementById('app').innerHTML = (currentView==='admin') ? adminView() : shopView(); }
    render();
  </script>
</body>
</html>
