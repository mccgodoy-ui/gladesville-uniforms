<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pre-Loved Uniforms - Gladesville Public School</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .cart-item { animation: slideIn 0.3s ease-in-out; }
    @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
  </style>
</head>
<body class="bg-gray-50">
  <div id="app"></div>

  <script>
    // ========= Admin PIN (client-side gate) =========
    var ADMIN_PIN = "gps-2025"; // â† change this
    function isAdminAuthed(){ return localStorage.getItem("adminAuthed")==="1"; }
    function adminLogin(){
      var pin = prompt("Enter Admin PIN:");
      if(pin===ADMIN_PIN){ localStorage.setItem("adminAuthed","1"); alert("Admin unlocked"); render(); }
      else if(pin!==null){ alert("Incorrect PIN"); }
    }
    function adminLogout(){ localStorage.removeItem("adminAuthed"); render(); }

    // ========= App State =========
    var currentView = 'shop';
    var cart = {};
    // include email + childClass + notes
    var customerInfo = { name:'', whatsapp:'', email:'', childClass:'', notes:'' };
    var orders = [];
    var isSubmitting = false;
    var showSuccessMessage = false;

    var inventory = [
      { id: 1, name: 'Polo Shirt', price: 2, category: 'Shirts' },
      { id: 2, name: 'Long Sleeve Polo', price: 2, category: 'Shirts' },
      { id: 3, name: 'School Pants', price: 2, category: 'Bottoms' },
      { id: 4, name: 'Skort', price: 2, category: 'Bottoms' },
      { id: 8, name: 'Tracksuit Pants', price: 2, category: 'Bottoms' },
      { id: 14, name: 'Shorts', price: 2, category: 'Bottoms' },
      { id: 15, name: 'Sports Shorts', price: 2, category: 'Bottoms' },
      { id: 5, name: 'Summer Dress', price: 2, category: 'Dresses' },
      { id: 6, name: 'Winter Tunic', price: 2, category: 'Dresses' },
      { id: 10, name: 'Jumper', price: 5, category: 'Winter' },
      { id: 11, name: 'Skivvy', price: 2, category: 'Winter' },
      { id: 12, name: 'School Hat', price: 2, category: 'Accessories' },
      { id: 13, name: 'School Bag', price: 5, category: 'Accessories' }
    ];
    var sizes = ['4','6','8','10','12','14','16'];
    var categories = ['Shirts','Bottoms','Dresses','Winter','Accessories'];

    // ========= Google Sheets endpoint =========
    var GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzn1SLkZ8g9eeNHcUXJUjra2igAaO5aLFNWxai06H4z6YjW0gluDyUZkTUTRsYIUMf_3g/exec';

    function sendToGoogleSheets(order){
      var orderData = {
        date: order.date,
        time: order.time,
        customer_name: order.customer.name,
        customer_whatsapp: order.customer.whatsapp,
        customer_email: order.customer.email || '',
        child_class: order.customer.childClass || '',
        notes: order.customer.notes || '',
        items: Object.values(order.items).map(function(item){
          return item.quantity + 'x ' + item.name + ' (Size ' + item.size + ') - $' + item.price;
        }).join('\n'),
        total: order.total
      };

      fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(orderData)
      }).then(function(){ console.log('Sent to Google Sheets'); })
        .catch(function(err){ console.error('Error sending to Google Sheets:', err); });
    }

    // ========= Helpers =========
    function addToCart(itemId, size){
      var item = inventory.find(function(i){ return i.id===itemId; });
      if(!item) return;
      var key = itemId + '-' + size;
      if(cart[key]) cart[key].quantity += 1;
      else cart[key] = Object.assign({}, item, { size:size, quantity:1 });
      render();
    }
    function removeFromCart(key){
      if(cart[key].quantity>1) cart[key].quantity -= 1;
      else delete cart[key];
      render();
    }
    function getCartTotal(){
      return Object.values(cart).reduce(function(t,i){ return t + (i.price*i.quantity); },0);
    }
    function getCartItemCount(){
      return Object.values(cart).reduce(function(t,i){ return t + i.quantity; },0);
    }

    function submitOrder(){
      if(!customerInfo.name || !customerInfo.whatsapp || !customerInfo.email || Object.keys(cart).length===0){
        alert('Please fill name, WhatsApp, email and add items.');
        return;
      }
      isSubmitting = true; render();

      var order = {
        id: Date.now(),
        customer: Object.assign({}, customerInfo),
        items: Object.assign({}, cart),
        total: getCartTotal(),
        date: new Date().toLocaleDateString(),
        time: new Date().toLocaleTimeString(),
        status: 'Pending'
      };

      orders.push(order);
      sendToGoogleSheets(order);

      cart = {};
      customerInfo = { name:'', whatsapp:'', email:'', childClass:'', notes:'' };

      setTimeout(function(){
        isSubmitting = false;
        showSuccessMessage = true; render();
        setTimeout(function(){ showSuccessMessage = false; render(); }, 3000);
      }, 1000);

      document.title = '(' + orders.length + ') New Orders - Gladesville Uniforms';
    }

    // ========= Renders =========
    function renderShopView(){
      var cartItemCount = getCartItemCount();
      var cartTotal = getCartTotal();

      return ''+
      '<div class="bg-white shadow-sm border-b-4 border-yellow-400">'+
        '<div class="max-w-4xl mx-auto px-4 py-6">'+
          '<div class="flex justify-between items-center">'+
            '<div>'+
              '<h1 class="text-3xl font-bold text-blue-900 flex items-center space-x-3">'+
                '<svg class="text-green-600 w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">'+
                  '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>'+
                '</svg>'+
                '<span>Pre-Loved Uniforms</span>'+
              '</h1>'+
              '<p class="text-blue-700 flex items-center space-x-2 mt-1">'+
                '<svg class="text-blue-600 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">'+
                  '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>'+
                  '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>'+
                '</svg>'+
                '<span>Gladesville Public School</span>'+
              '</p>'+
              '<p class="mt-1 text-xs text-gray-400 underline cursor-pointer" onclick="adminLogin()">Admin login</p>'+
            '</div>'+

            '<div class="flex items-center space-x-4">'+
              (isAdminAuthed()
                ? '<button onclick="currentView=\\'admin\\'; render();" class="text-gray-600 hover:text-blue-900 relative" title="Admin">'+
                    '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">'+
                      '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>'+
                      '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>'+
                    '</svg>'+
                    (orders.length>0
                      ? '<span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-4 w-4 flex items-center justify-center">'+orders.length+'</span>'
                      : ''
                    )+
                  '</button>'
                : ''
              )+
              '<div class="relative">'+
                '<svg class="text-blue-900 w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">'+
                  '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m0 0H17M9 19.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zm11 0a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z"></path>'+
                '</svg>'+
                (cartItemCount>0
                  ? '<span class="absolute -top-2 -right-2 bg-yellow-400 text-blue-900 text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">'+cartItemCount+'</span>'
                  : ''
                )+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>'+
      '</div>'+

      '<div class="max-w-4xl mx-auto px-4 py-6">'+
        '<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">'+

          '<div class="lg:col-span-2">'+
            '<div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-6">'+
              '<div class="flex"><div class="ml-3">'+
                '<h3 class="text-sm font-medium text-blue-800">How it works:</h3>'+
                '<div class="mt-2 text-sm text-blue-700">'+
                  '<p>1. Select items and sizes</p>'+
                  '<p>2. Submit your pre-order</p>'+
                  '<p>3. We\\'ll send photos via WhatsApp</p>'+
                  '<p>4. Pay through Qkr! when ready</p>'+
                  '<p>5. Pickup at school (above lost property cage)</p>'+
                '</div>'+
              '</div></div>'+
            '</div>'+

            + categories.map(function(category){
              var items = inventory.filter(function(i){ return i.category===category; });
              if(items.length===0) return '';
              return ''+
              '<div class="mb-8">'+
                '<h2 class="text-xl font-semibold text-blue-900 mb-4 border-b-2 border-yellow-400 pb-2">'+category+'</h2>'+
                '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">'+
                  items.map(function(item){
                    return ''+
                    '<div class="bg-white p-4 rounded-lg shadow hover:shadow-md transition-shadow">'+
                      '<div class="flex justify-between items-start mb-3">'+
                        '<h3 class="font-semibold text-gray-900">'+item.name+'</h3>'+
                        '<span class="text-lg font-bold text-blue-600">$'+item.price+'</span>'+
                      '</div>'+
                      '<div class="grid grid-cols-4 gap-2">'+
                        sizes.map(function(size){
                          return '<button onclick="addToCart('+item.id+', \\''
                                 + size +'\\')" class="bg-blue-100 hover:bg-blue-200 text-blue-800 py-2 px-3 rounded text-sm font-medium transition-colors">'
                                 + size +'</button>';
                        }).join('')+
                      '</div>'+
                    '</div>';
                  }).join('')+
                '</div>'+
              '</div>';
            }).join('') +

          '</div>'+

          '<div class="lg:col-span-1">'+
            '<div class="bg-white p-6 rounded-lg shadow sticky top-6">'+
              '<h2 class="text-xl font-semibold text-blue-900 mb-4">Your Order</h2>'+

              '<div class="space-y-3 mb-4">'+
                '<div class="flex items-center space-x-2">'+
                  '<svg class="text-blue-600 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">'+
                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>'+
                  '</svg>'+
                  '<input type="text" placeholder="Your name" value="'+customerInfo.name+'" onchange="customerInfo.name=this.value" class="flex-1 border border-gray-300 rounded px-3 py-2 text-sm">'+
                '</div>'+

                '<div class="flex items-center space-x-2">'+
                  '<svg class="text-blue-600 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">'+
                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>'+
                  '</svg>'+
                  '<input type="tel" placeholder="WhatsApp number" value="'+customerInfo.whatsapp+'" onchange="customerInfo.whatsapp=this.value" class="flex-1 border border-gray-300 rounded px-3 py-2 text-sm">'+
                '</div>'+

                '<div class="flex items-center space-x-2">'+
                  '<svg class="text-blue-600 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">'+
                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12H8m8 0l-8-6m8 6l-8 6"></path>'+
                  '</svg>'+
                  '<input type="email" placeholder="Email (for confirmation)" value="'+(customerInfo.email||'')+'" onchange="customerInfo.email=this.value" class="flex-1 border border-gray-300 rounded px-3 py-2 text-sm">'+
                '</div>'+

                '<div class="flex items-center space-x-2">'+
                  '<svg class="text-blue-600 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">'+
                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z"></path>'+
                  '</svg>'+
                  '<input type="text" placeholder="Child\\'s class (e.g., 1B)" value="'+(customerInfo.childClass||'')+'" onchange="customerInfo.childClass=this.value" class="flex-1 border border-gray-300 rounded px-3 py-2 text-sm">'+
                '</div>'+

                '<div class="flex items-start space-x-2">'+
                  '<svg class="text-blue-600 w-5 h-5 mt-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">'+
                    '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16h8M8 12h8M8 8h8M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H9l-4 4v10a2 2 0 002 2z"></path>'+
                  '</svg>'+
                  '<textarea placeholder="Notes (e.g., prefer navy, specific sizes, pickup day)" onchange="customerInfo.notes=this.value" class="flex-1 border border-gray-300 rounded px-3 py-2 text-sm" rows="3">'+(customerInfo.notes||'')+'</textarea>'+
                '</div>'+
              '</div>'+

              '<div class="space-y-3 mb-4 max-h-64 overflow-y-auto">'+
                (Object.keys(cart).length===0
                  ? '<p class="text-gray-500 text-sm">No items in cart</p>'
                  : Object.entries(cart).map(function(entry){
                      var key = entry[0], item = entry[1];
                      return ''+
                      '<div class="flex items-center justify-between p-2 bg-gray-50 rounded cart-item">'+
                        '<div class="flex-1">'+
                          '<p class="text-sm font-medium">'+item.name+'</p>'+
                          '<p class="text-xs text-gray-600">Size '+item.size+'</p>'+
                        '</div>'+
                        '<div class="flex items-center space-x-2">'+
                          '<button onclick="removeFromCart(\\''+key+'\\')" class="text-blue-600 hover:text-blue-800">'+
                            '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">'+
                              '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>'+
                            '</svg>'+
                          '</button>'+
                          '<span class="text-sm font-medium">'+item.quantity+'</span>'+
                          '<button onclick="addToCart('+item.id+', \\''
                             + item.size +'\\')" class="text-blue-600 hover:text-blue-800">'+
                            '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">'+
                              '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>'+
                            '</svg>'+
                          '</button>'+
                        '</div>'+
                      '</div>';
                    }).join('')
                )+
              '</div>'+

              (Object.keys(cart).length>0
                ? '<div class="border-t pt-4 mb-4">'+
                    '<div class="flex justify-between items-center">'+
                      '<span class="font-semibold">Total:</span>'+
                      '<span class="text-xl font-bold text-blue-600">$'+cartTotal+'</span>'+
                    '</div>'+
                  '</div>'
                : ''
              )+

              '<button onclick="submitOrder()" '+
                ( !customerInfo.name || !customerInfo.whatsapp || !customerInfo.email || Object.keys(cart).length===0 || isSubmitting ? 'disabled' : '' )+
                ' class="w-full '+
                ( isSubmitting ? 'bg-blue-400' :
                  (!customerInfo.name || !customerInfo.whatsapp || !customerInfo.email || Object.keys(cart).length===0)
                  ? 'bg-gray-400' : 'bg-blue-600 hover:bg-blue-700'
                )+
                ' text-white font-semibold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2">'+
                  (isSubmitting
                    ? '<svg class="animate-spin w-5 h-5" fill="none" viewBox="0 0 24 24">'+
                        '<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>'+
                        '<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>'+
                      '</svg><span>Submitting...</span>'
                    : '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">'+
                        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>'+
                      '</svg><span>Submit Pre-Order</span>'
                  )+
              '</button>'+

            '</div>'+
          '</div>'+

        '</div>'+
      '</div>';
    }

    function renderAdminView(){
      return ''+
      '<div class="min-h-screen bg-gray-50">'+
        '<div class="bg-white shadow-sm border-b border-gray-200">'+
          '<div class="max-w-4xl mx-auto px-4 py-4">'+
            '<div class="flex justify-between items-center">'+
              '<h1 class="text-2xl font-bold text-gray-900">Admin Panel</h1>'+
              '<div>'+
                '<button onclick="currentView=\\'shop\\'; render();" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Back to Shop</button>'+
                '<button onclick="adminLogout()" class="ml-2 border border-gray-300 px-3 py-2 rounded-lg hover:bg-gray-50">Logout</button>'+
              '</div>'+
            '</div>'+
          '</div>'+
        '</div>'+

        '<div class="max-w-4xl mx-auto px-4 py-6 space-y-8">'+
          '<div class="bg-white p-6 rounded-lg shadow">'+
            '<h2 class="text-xl font-semibold mb-4">Orders ('+orders.length+')</h2>'+
            '<div class="space-y-4">'+
              (orders.length===0
                ? '<p class="text-gray-500">No orders yet</p>'
                : orders.map(function(order){
                    return ''+
                    '<div class="border border-gray-200 rounded-lg p-4">'+
                      '<div class="flex justify-between items-start mb-3">'+
                        '<div>'+
                          '<h3 class="font-semibold">'+order.customer.name+'</h3>'+
                          '<p class="text-sm text-gray-600">WhatsApp: '+order.customer.whatsapp+'</p>'+
                          (order.customer.email ? '<p class="text-sm text-gray-600">Email: '+order.customer.email+'</p>' : '')+
                          (order.customer.childClass ? '<p class="text-sm text-gray-600">Class: '+order.customer.childClass+'</p>' : '')+
                          (order.customer.notes ? '<p class="text-sm text-gray-600">Notes: '+order.customer.notes+'</p>' : '')+
                          '<p class="text-sm text-gray-600">Date: '+order.date+' at '+order.time+'</p>'+
                        '</div>'+
                        '<div class="text-right">'+
                          '<p class="font-semibold text-lg">$'+order.total+'</p>'+
                          '<button onclick="deleteOrder('+order.id+')" class="text-red-600 hover:text-red-800 mt-2">'+
                            '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">'+
                              '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>'+
                            '</svg>'+
                          '</button>'+
                        '</div>'+
                      '</div>'+
                      '<div class="space-y-1">'+
                        Object.values(order.items).map(function(item){
                          return '<p class="text-sm text-gray-700">'+item.quantity+'x '+item.name+' (Size '+item.size+') - $'+item.price+' each</p>';
                        }).join('')+
                      '</div>'+
                    '</div>';
                  }).join('')
              )+
            '</div>'+
          '</div>'+
        '</div>'+
      '</div>';
    }

    function render(){
      var app = document.getElementById('app');
      if(currentView==='admin' && !isAdminAuthed()){
        alert('Admin locked'); currentView='shop';
      }
      app.innerHTML = (currentView==='admin' ? renderAdminView() : renderShopView());
    }

    // Initial render
    render();
  </script>
</body>
</html>
